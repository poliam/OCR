{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Search</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="{% static 'css/mainstyle.css' %}">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css">
	<style type="text/css">
		.TagsName{
			border-radius: 2px;
		    color: #0d6efd;
		    margin: 3px;
		    padding: 0px 3px 1px 3px;
		    background-color: #ced9e9;
		}
	</style>
</head>
<body>
{% include "includes/header.html" %}
<br/>


	<div class="row">
		<div class="col-md-12" style="text-align: center;">
			<h1>SEARCH DOCUMENT</h1>
			
		</div>
	</div>
	<br/>
	<div class="row" style="padding:2%">
		<div class="col-md-2">
		  	<form method="POST" id="AdvaceSearchForm">
		  		{% csrf_token %}
			  	<h3 id="header-and-footer">Advance Search<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="#" href="#header-and-footer" style="padding-left: 0.375em;"></a></h3>
			  	<label>Document owner</label>
			  	<select class="form-control" aria-describedby="button-addon2" name="documentOwnerSelect" id="documentOwnerSelect">
			  		<option value="0">-- Department owner --</option>
			  		{% for department in departments %}
			  			{% if department.pk == documentOwner %}
			  				<option value="{{ department.pk }}" selected>{{ department.departmentName}}</option>
			  			{% else %}
			  				<option value="{{ department.pk }}">{{ department.departmentName}}</option>
			  			{% endif %}
			  		{% endfor %}
			  	</select>
			  	<label>Document Types</label>
			  	<div class="input-group mb-3">
			  		<select class="form-control" aria-describedby="button-addon2" id="documentTypesSelect">
			  			<option value="0">-- Types --</option>
			  			{% for type in docTypeList %}
			  				<option value="{{ type.pk }}">{{ type.name}}</option>
			  			{% endfor %}
			  		</select>
				  	<button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="addDocumentTypes()">Add</button>
				</div>
				<div id="DocumentTypeInputs">
					
				</div>
				<div id="TypeWrapper" style="border: 1px solid black; border-radius: 10px; padding: 10px 5px; display:none;">
					
				</div>
				<label>Document Tags</label>
			  	<div class="input-group mb-3">
				  	<select class="form-control" aria-describedby="button-addon2" id="documentTagsSelect">
				  		<option value="0">-- Tags -- </option>
				  		{% for tag in listOfTags %}
				  			<option value="{{ tag.pk }}">{{ tag.name }}</option>
				  		{% endfor %}
				  	</select>
				  	<button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="addDocumentTags()">Add</button>
				</div>
				<div id="TagWrapper" style="border: 1px solid black; border-radius: 10px; padding: 10px 5px; display:none;">
					
				</div>
				<div id="DocumentTagInputs">
					
				</div>
				<br/>

				<button type="button" class="form-control btn btn-light" onclick="ResetSearchBtn()">Reset</button>
				<button type="submit" class="form-control btn btn-secondary" id="SearchBtn">Search</button>
			</form>
		</div>
		<div class="col-md-10">
			<table id="DocumentFullList" class="table table-striped table-hover">
				<thead>
				  	<th>#</th>
				  	<th>Document Name</th>
				  	<th>Document Description</th>
				  	<th>Document Type</th>
				  	<th style="display: none;">Document Text</th>
				  	<th>Option</th>
			  	</thead>
			  	<tbody>
			  		{% for document in documents %}
			  			<tr>
			  				<td>{{ forloop.counter }}</td>
			  				<td><b><a href="{% url 'viewDocument' document.pk %}" style="text-decoration: none;">{{ document.name }}</a></b></td>
			  				<td>{{ document.description }}</td>
			  				<td>{{ document.docType.name }}</td>
			  				<td style="display: none;">{{ document.docInsideText }}</td>
			  				<td>
			  					<a href="{% url 'editDocument' document.pk %}">
			  						<svg style="cursor: pointer;" onclick="" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
		  								<path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
		  								<path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
									</svg>
								</a>
			  					<a href="{% url 'viewDocument' document.pk %}">
			  						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
								  		<path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
								  		<path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
									</svg>
								</a>
			  				</td>
			  			</tr>
			  		{% endfor %}
			  	</tbody>
			</table>
		</div>
	</div>

<form id="TypeForm">
	{% for type in docTypeList %}
		{% if type.pk in post_types %}
			<input type="hidden" name="{{ type.name }}" value="{{ type.pk }}">
		{% endif %}
	{% endfor %}
</form>

<form id="TagForm">
	{% for tag in listOfTags %}
		{% if tag.pk in post_tags %}
			<input type="hidden" name="{{ tag.name }}" value="{{ tag.pk }}">
		{% endif %}
	{% endfor %}
</form>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js" integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js" integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK" crossorigin="anonymous"></script>
<script src="//cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"  type="text/javascript"></script>
<script type="text/javascript">
	$(document).ready( function () {
	    $('#DocumentFullList').DataTable();
	    currentTypes = $("#TypeForm").serializeArray();
	    $.each(currentTypes, function(index, value){
			$("#TypeWrapper").append("<span class='TagsName'>"+value.name+" <svg style='cursor: pointer;' typevalue='"+value.value+"' onclick='removeType(this);' xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-x-circle' viewBox='0 0 16 16'><path d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'/><path d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/></svg></span>");
			$("#DocumentTypeInputs").append("<input type='hidden' value='"+value.value+"' name='documenttypes[]'>");
			$("#TypeWrapper").show();
		})
		currentTag = $("#TagForm").serializeArray();
		$.each(currentTag, function(index, value){
			$("#TagWrapper").append("<span class='TagsName'>"+value.name+" <svg style='cursor: pointer;' typevalue='"+value.value+"' onclick='removeTag(this);' xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-x-circle' viewBox='0 0 16 16'><path d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'/><path d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/></svg></span>");
			$("#DocumentTagInputs").append("<input type='hidden' value='"+value.value+"' name='documenttags[]'>");
			$("#TagWrapper").show();
		})
	} );

	function addDocumentTypes(){
		var documentTypesSelect = $("#documentTypesSelect").val();
		var documentTypesSelectText = $("#documentTypesSelect :selected").text();
		currentTypes = $("#TypeForm").serializeArray();
		if (documentTypesSelect != 0){
			if (currentTypes.length == 0){
				$("#TypeForm").append("<input type='hidden' value='"+documentTypesSelect+"' name='"+documentTypesSelectText+"'>");
				$("#TypeWrapper").append("<span class='TagsName'>"+documentTypesSelectText+" <svg style='cursor: pointer;' typevalue='"+documentTypesSelect+"' onclick='removeType(this);' xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-x-circle' viewBox='0 0 16 16'><path d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'></path><path d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'></path></svg></span>");
				$("#DocumentTypeInputs").append("<input type='hidden' value='"+documentTypesSelect+"' name='documenttypes[]'>");
				$("#TypeWrapper").show();
			}else{
				var AlreadyAType = 0;
				$.each(currentTypes, function(index, value){
					if (value.value == documentTypesSelect){ AlreadyAType = 1; }
				})
				if(AlreadyAType == 0){
					$("#TypeForm").append("<input type='hidden' value='"+documentTypesSelect+"' name='"+documentTypesSelectText+"'>");
					$("#TypeWrapper").append("<span class='TagsName'>"+documentTypesSelectText+" <svg style='cursor: pointer;' typevalue='"+documentTypesSelect+"' onclick='removeType(this);' xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-x-circle' viewBox='0 0 16 16'><path d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'/><path d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/></svg></span>");
					$("#DocumentTypeInputs").append("<input type='hidden' value='"+documentTypesSelect+"' name='documenttypes[]'>");
				}
			}
			$("#documentTypesSelect").val(0)
		}
		
	}

	function removeType(that){
		currentTypes = $("#TypeForm").serializeArray();
		$("#TypeForm").empty();
		$("#TypeWrapper").empty();
		$("#DocumentTypeInputs").empty();
		var typeValue = $(that).attr("typevalue");
		$.each(currentTypes, function(index, value){
			console.log(value.value+"=="+typeValue)
			if (value.value != typeValue){
				$("#TypeForm").append("<input type='hidden' value='"+value.value+"' name='"+value.name+"'>");
				$("#TypeWrapper").append("<span class='TagsName'>"+value.name+" <svg style='cursor: pointer;' typevalue='"+value.value+"' onclick='removeType(this);' xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-x-circle' viewBox='0 0 16 16'><path d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'/><path d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/></svg></span>");
				$("#DocumentTypeInputs").append("<input type='hidden' value='"+value.value+"' name='documenttypes[]'>");
			}
		})
		currentTypes = $("#TypeForm").serializeArray();
		if(currentTypes.length == 0){
			$("#TypeWrapper").hide();
		}
	}

	function addDocumentTags(){
		var documentTagsSelect = $("#documentTagsSelect").val();
		var documentTagsSelectText = $("#documentTagsSelect :selected").text();
		currentTags = $("#TagForm").serializeArray();
		if (documentTagsSelect != 0){
			if (currentTags.length == 0){
				$("#TagForm").append("<input type='hidden' value='"+documentTagsSelect+"' name='"+documentTagsSelectText+"'>");
				$("#TagWrapper").append("<span class='TagsName'>"+documentTagsSelectText+" <svg style='cursor: pointer;' typevalue='"+documentTagsSelect+"' onclick='removeTag(this);' xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-x-circle' viewBox='0 0 16 16'><path d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'></path><path d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'></path></svg></span>");
				$("#TagWrapper").show();
				$("#DocumentTagInputs").append("<input type='hidden' value='"+documentTagsSelect+"' name='documenttags[]'>");
			}else{
				var AlreadyATag = 0;
				$.each(currentTags, function(index, value){
					if (value.value == documentTagsSelect){ AlreadyATag = 1; }
				})
				if(AlreadyATag == 0){
					$("#TagForm").append("<input type='hidden' value='"+documentTagsSelect+"' name='"+documentTagsSelectText+"'>");
					$("#TagWrapper").append("<span class='TagsName'>"+documentTagsSelectText+" <svg style='cursor: pointer;' typevalue='"+documentTagsSelect+"' onclick='removeTag(this);' xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-x-circle' viewBox='0 0 16 16'><path d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'/><path d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/></svg></span>");
					$("#DocumentTagInputs").append("<input type='hidden' value='"+documentTagsSelect+"' name='documenttags[]'>");
				}
			}
			$("#documentTagsSelect").val(0)
		}
	}

	function removeTag(that){
		currentTag = $("#TagForm").serializeArray();
		$("#TagForm").empty();
		$("#TagWrapper").empty();
		$("#DocumentTagInputs").empty();
		var tagValue = $(that).attr("typevalue");
		$.each(currentTag, function(index, value){
			if (value.value != tagValue){
				$("#TagForm").append("<input type='hidden' value='"+value.value+"' name='"+value.name+"'>");
				$("#TagWrapper").append("<span class='TagsName'>"+value.name+" <svg style='cursor: pointer;' typevalue='"+value.value+"' onclick='removeTag(this);' xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-x-circle' viewBox='0 0 16 16'><path d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'/><path d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/></svg></span>");
				$("#DocumentTagInputs").append("<input type='hidden' value='"+value.value+"' name='documenttags[]'>");
			}
		})
		currentTag = $("#TagForm").serializeArray();
		if(currentTag.length == 0){
			$("#TagWrapper").hide();
		}
	}

	function ResetSearchBtn(){
		console.log("here");
		$("#documentOwnerSelect").val("0");
		$("#documentTypesSelect").val("0");
		$("#documentTagsSelect").val("0");
		$("#TypeWrapper").empty();
		$("#TagWrapper").empty();
		$("#TypeWrapper").hide();
		$("#TagWrapper").hide();
		$("#TypeForm").empty();
		$("#TagForm").empty();
		$("#DocumentTagInputs").empty();
		$("#DocumentTypeInputs").empty();
		$("#AdvaceSearchForm").submit();
	}
</script>
</body>
</html>